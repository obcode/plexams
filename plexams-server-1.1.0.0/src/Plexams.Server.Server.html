<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plexams.Server.Server</span><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Plexams.Server.Server.html#startApp"><span class="hs-identifier hs-var">startApp</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Concurrent.STM.TVar</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Reader</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.STM</span><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.List</span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">nub</span><span>
</span><a name="line-18"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">partition</span><span>
</span><a name="line-19"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span>
</span><a name="line-20"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span>                     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Text</span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-24"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unpack</span><span>
</span><a name="line-25"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Exts</span><span>                       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">groupWith</span><span>
</span><a name="line-27"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span>
</span><a name="line-28"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.Wai</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.Wai.Handler.Warp</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Network.Wai.Middleware.Cors</span><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Servant</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Import</span><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Invigilation</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.PlanManip</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Query</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">conflictingSlotsForAncode</span><span>
</span><a name="line-40"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">queryRoomByID</span><span>
</span><a name="line-41"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Types</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.UpdateFiles</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Validation</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-keyword">type</span><span> </span><a name="API"><a href="Plexams.Server.Server.html#API"><span class="hs-identifier">API</span></a></a><span>
</span><a name="line-47"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;exams&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-48"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;exam&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;examDays&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-50"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;slots&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Slots</span><span>
</span><a name="line-51"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;slot&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-52"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;slotByRooms&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Room</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-53"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;slotsPerDay&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-54"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;slotsForDay&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Slots</span><span>
</span><a name="line-55"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;conflictingSlots&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span>
</span><a name="line-56"></a><span>                    </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;addExam&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">AddExamToSlot</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;unscheduledExams&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-59"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;notPlannedByMeExams&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">]</span><span>
</span><a name="line-60"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;validation&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidateWhat</span><span class="hs-special">]</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Validation</span><span>
</span><a name="line-61"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;examsBySameLecturer&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Ancode</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-62"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;goSlots&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-63"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;lecturer&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Person</span><span class="hs-special">]</span><span>
</span><a name="line-64"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;validateWhat&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidateWhat</span><span class="hs-special">]</span><span>
</span><a name="line-65"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;reloadPlan&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;plan&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Plan</span><span>
</span><a name="line-67"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;semesterConfig&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">SemesterConfig</span><span>
</span><a name="line-68"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;invigilators&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Invigilations</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Invigilator</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;invigilatorsForDay&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Invigilator</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Invigilator</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;addInvigilator&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">AddInvigilatorToRoomOrSlot</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;removeInvigilator&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">ReqBody</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">RemoveInvigilatorFromRoomOrSlot</span><span> </span><span class="hs-operator">:&gt;</span><span> </span><span class="hs-identifier hs-type">Post</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;examsWithNTA&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-73"></a><span>      </span><span class="hs-operator">:&lt;|&gt;</span><span> </span><span class="hs-string">&quot;plannedRooms&quot;</span><span> </span><span class="hs-operator hs-type">:&gt;</span><span> </span><span class="hs-identifier hs-type">Get</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-type">JSON</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">PlannedRoomWithSlots</span><span class="hs-special">]</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-keyword">newtype</span><span> </span><a name="State"><a href="Plexams.Server.Server.html#State"><span class="hs-identifier">State</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="State"><a href="Plexams.Server.Server.html#State"><span class="hs-identifier">State</span></a></a><span>
</span><a name="line-76"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="plan"><a href="Plexams.Server.Server.html#plan"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">TVar</span><span> </span><span class="hs-identifier hs-type">Plan</span><span>
</span><a name="line-77"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">type</span><span> </span><a name="StateHandler"><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier">StateHandler</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">ReaderT</span><span> </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-identifier hs-type">Handler</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">stateHandlerToHandler</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><a href="#local-6989586621679096772"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Handler</span><span> </span><a href="#local-6989586621679096772"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-82"></a><a name="stateHandlerToHandler"><a href="Plexams.Server.Server.html#stateHandlerToHandler"><span class="hs-identifier">stateHandlerToHandler</span></a></a><span> </span><a name="local-6989586621679096773"><a href="#local-6989586621679096773"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679096774"><span class="hs-identifier hs-var">stateHandlerToHandler'</span></a><span>
</span><a name="line-83"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-identifier">stateHandlerToHandler'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><a href="#local-6989586621679096775"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Handler</span><span> </span><a href="#local-6989586621679096775"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-85"></a><span>  </span><a name="local-6989586621679096774"><a href="#local-6989586621679096774"><span class="hs-identifier">stateHandlerToHandler'</span></a></a><span> </span><a name="local-6989586621679096776"><a href="#local-6989586621679096776"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runReaderT</span><span> </span><a href="#local-6989586621679096776"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679096773"><span class="hs-identifier hs-var">state</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-identifier">startApp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><a name="startApp"><a href="Plexams.Server.Server.html#startApp"><span class="hs-identifier">startApp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-89"></a><span>  </span><span class="hs-identifier hs-var">setPlexamsDirectory</span><span>
</span><a name="line-90"></a><span>  </span><a name="local-6989586621679096777"><a href="#local-6989586621679096777"><span class="hs-identifier">plan'</span></a></a><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Server.Server.html#getPlan"><span class="hs-identifier hs-var">getPlan</span></a><span>
</span><a name="line-91"></a><span>  </span><a name="local-6989586621679096778"><a href="#local-6989586621679096778"><span class="hs-identifier">planTVar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">newTVar</span><span> </span><a href="#local-6989586621679096777"><span class="hs-identifier hs-var">plan'</span></a><span>
</span><a name="line-92"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679096779"><a href="#local-6989586621679096779"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><a href="#local-6989586621679096778"><span class="hs-identifier hs-var">planTVar</span></a><span>
</span><a name="line-93"></a><span>  </span><span class="hs-identifier hs-var">run</span><span> </span><span class="hs-number">8080</span><span> </span><span class="hs-special">(</span><a href="Plexams.Server.Server.html#app"><span class="hs-identifier hs-var">app</span></a><span> </span><a href="#local-6989586621679096779"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-identifier">getPlan</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-identifier hs-type">Plan</span><span>
</span><a name="line-96"></a><a name="getPlan"><a href="Plexams.Server.Server.html#getPlan"><span class="hs-identifier">getPlan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-97"></a><span>  </span><span class="hs-special">(</span><a name="local-6989586621679096909"><a href="#local-6989586621679096909"><span class="hs-identifier">maybePlan</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679096910"><a href="#local-6989586621679096910"><span class="hs-identifier">errorMessages</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">importPlan</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unpack</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679096910"><span class="hs-identifier hs-var">errorMessages</span></a><span>
</span><a name="line-99"></a><span>  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679096909"><span class="hs-identifier hs-var">maybePlan</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679098201"><a href="#local-6989586621679098201"><span class="hs-identifier">plan'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679098201"><span class="hs-identifier hs-var">plan'</span></a><span>
</span><a name="line-101"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;no plan&quot;</span><span>
</span><a name="line-102"></a><span>
</span><a name="line-103"></a><span class="hs-identifier">app</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Application</span><span>
</span><a name="line-104"></a><a name="app"><a href="Plexams.Server.Server.html#app"><span class="hs-identifier">app</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cors</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679098216"><span class="hs-identifier hs-var">corsPolicy</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">serve</span><span> </span><a href="Plexams.Server.Server.html#api"><span class="hs-identifier hs-var">api</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Plexams.Server.Server.html#server"><span class="hs-identifier hs-var">server</span></a><span>
</span><a name="line-105"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-106"></a><span>  </span><a name="local-6989586621679098216"><a href="#local-6989586621679098216"><span class="hs-identifier">corsPolicy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">simpleCorsResourcePolicy</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">corsRequestHeaders</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-string">&quot;authorization&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;content-type&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-identifier">api</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="Plexams.Server.Server.html#API"><span class="hs-identifier hs-type">API</span></a><span>
</span><a name="line-111"></a><a name="api"><a href="Plexams.Server.Server.html#api"><span class="hs-identifier">api</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Proxy</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-identifier">server</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-type">State</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Server</span><span> </span><a href="Plexams.Server.Server.html#API"><span class="hs-identifier hs-type">API</span></a><span>
</span><a name="line-114"></a><a name="server"><a href="Plexams.Server.Server.html#server"><span class="hs-identifier">server</span></a></a><span> </span><a name="local-6989586621679098239"><a href="#local-6989586621679098239"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-115"></a><span>  </span><span class="hs-identifier hs-var">hoistServer</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><a href="Plexams.Server.Server.html#API"><span class="hs-identifier hs-type">API</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Plexams.Server.Server.html#stateHandlerToHandler"><span class="hs-identifier hs-var">stateHandlerToHandler</span></a><span> </span><a href="#local-6989586621679098239"><span class="hs-identifier hs-var">state</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-operator hs-var">$</span><span>    </span><a href="#local-6989586621679098243"><span class="hs-identifier hs-var">exams'</span></a><span>
</span><a name="line-117"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098244"><span class="hs-identifier hs-var">exam'</span></a><span>
</span><a name="line-118"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098248"><span class="hs-identifier hs-var">examDays'</span></a><span>
</span><a name="line-119"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098249"><span class="hs-identifier hs-var">slots'</span></a><span>
</span><a name="line-120"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098250"><span class="hs-identifier hs-var">slot'</span></a><span>
</span><a name="line-121"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098251"><span class="hs-identifier hs-var">slotByRooms'</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098252"><span class="hs-identifier hs-var">slotsPerDay'</span></a><span>
</span><a name="line-123"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098253"><span class="hs-identifier hs-var">slotsForDay'</span></a><span>
</span><a name="line-124"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098254"><span class="hs-identifier hs-var">conflictingSlots'</span></a><span>
</span><a name="line-125"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098262"><span class="hs-identifier hs-var">addExam'</span></a><span>
</span><a name="line-126"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098255"><span class="hs-identifier hs-var">unscheduledExams'</span></a><span>
</span><a name="line-127"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098256"><span class="hs-identifier hs-var">notPlannedByMeExams'</span></a><span>
</span><a name="line-128"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098259"><span class="hs-identifier hs-var">validation'</span></a><span>
</span><a name="line-129"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098257"><span class="hs-identifier hs-var">examsBySameLecturer'</span></a><span>
</span><a name="line-130"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098260"><span class="hs-identifier hs-var">goSlots'</span></a><span>
</span><a name="line-131"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098261"><span class="hs-identifier hs-var">lecturer'</span></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098240"><span class="hs-identifier hs-var">validateWhat'</span></a><span>
</span><a name="line-133"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098265"><span class="hs-identifier hs-var">reloadPlan'</span></a><span>
</span><a name="line-134"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098241"><span class="hs-identifier hs-var">plan'</span></a><span>
</span><a name="line-135"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098242"><span class="hs-identifier hs-var">semesterConfig'</span></a><span>
</span><a name="line-136"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098246"><span class="hs-identifier hs-var">invigilators'</span></a><span>
</span><a name="line-137"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098247"><span class="hs-identifier hs-var">invigilatorsForDay'</span></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098263"><span class="hs-identifier hs-var">addInvigilator</span></a><span>
</span><a name="line-139"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098264"><span class="hs-identifier hs-var">removeInvigilator</span></a><span>
</span><a name="line-140"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098245"><span class="hs-identifier hs-var">examsWithNTA'</span></a><span>
</span><a name="line-141"></a><span>    </span><span class="hs-operator hs-var">:&lt;|&gt;</span><span> </span><a href="#local-6989586621679098258"><span class="hs-identifier hs-var">plannedRooms'</span></a><span>
</span><a name="line-142"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-identifier">validateWhat'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidateWhat</span><span class="hs-special">]</span><span>
</span><a name="line-145"></a><span>  </span><a name="local-6989586621679098240"><a href="#local-6989586621679098240"><span class="hs-identifier">validateWhat'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">validateWhat</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span>  </span><span class="hs-identifier">plan'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-identifier hs-type">Plan</span><span>
</span><a name="line-148"></a><span>  </span><a name="local-6989586621679098241"><a href="#local-6989586621679098241"><span class="hs-identifier">plan'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-149"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679098421"><a href="#local-6989586621679098421"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679098421"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>  </span><span class="hs-identifier">semesterConfig'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-identifier hs-type">SemesterConfig</span><span>
</span><a name="line-153"></a><span>  </span><a name="local-6989586621679098242"><a href="#local-6989586621679098242"><span class="hs-identifier">semesterConfig'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-154"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679098444"><a href="#local-6989586621679098444"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679098444"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>  </span><span class="hs-identifier">exams'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-158"></a><span>  </span><a name="local-6989586621679098243"><a href="#local-6989586621679098243"><span class="hs-identifier">exams'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-159"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679098459"><a href="#local-6989586621679098459"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-160"></a><span>    </span><a name="local-6989586621679098460"><a href="#local-6989586621679098460"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679098459"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">allExams</span><span> </span><a href="#local-6989586621679098460"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span>  </span><span class="hs-identifier">exam'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Integer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">)</span><span>
</span><a name="line-164"></a><span>  </span><a name="local-6989586621679098244"><a href="#local-6989586621679098244"><span class="hs-identifier">exam'</span></a></a><span> </span><a name="local-6989586621679098461"><a href="#local-6989586621679098461"><span class="hs-identifier">examid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-165"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679098462"><a href="#local-6989586621679098462"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-166"></a><span>    </span><a name="local-6989586621679098463"><a href="#local-6989586621679098463"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679098462"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-167"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679098461"><span class="hs-identifier hs-var">examid</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">anCode</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">allExams</span><span> </span><a href="#local-6989586621679098463"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-168"></a><span>
</span><a name="line-169"></a><span>  </span><span class="hs-identifier">examsWithNTA'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-170"></a><span>  </span><a name="local-6989586621679098245"><a href="#local-6989586621679098245"><span class="hs-identifier">examsWithNTA'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-171"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102481"><a href="#local-6989586621679102481"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-172"></a><span>    </span><a name="local-6989586621679102482"><a href="#local-6989586621679102482"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102481"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-173"></a><span>    </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-174"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">groupWith</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">personID</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">lecturer</span><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">personShortName</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">lecturer</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">examsWithNTA</span><span> </span><a href="#local-6989586621679102482"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span>  </span><span class="hs-identifier">invigilators'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Invigilations</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Invigilator</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>  </span><a name="local-6989586621679098246"><a href="#local-6989586621679098246"><span class="hs-identifier">invigilators'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-180"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102483"><a href="#local-6989586621679102483"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-181"></a><span>    </span><a name="local-6989586621679102484"><a href="#local-6989586621679102484"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102483"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-182"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkInvigilations</span><span> </span><a href="#local-6989586621679102484"><span class="hs-identifier hs-var">plan''</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">invigilators</span><span> </span><a href="#local-6989586621679102484"><span class="hs-identifier hs-var">plan''</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span>  </span><span class="hs-identifier">invigilatorsForDay'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Invigilator</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Invigilator</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-185"></a><span>  </span><a name="local-6989586621679098247"><a href="#local-6989586621679098247"><span class="hs-identifier">invigilatorsForDay'</span></a></a><span> </span><a name="local-6989586621679102485"><a href="#local-6989586621679102485"><span class="hs-identifier">dayIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-186"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102486"><a href="#local-6989586621679102486"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-187"></a><span>    </span><a name="local-6989586621679102487"><a href="#local-6989586621679102487"><span class="hs-identifier">invigilators''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">invigilators</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102486"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-188"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679102488"><a href="#local-6989586621679102488"><span class="hs-identifier">wantAndPlannedInvigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span>
</span><a name="line-189"></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679102490"><a href="#local-6989586621679102490"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-190"></a><span>            </span><a href="#local-6989586621679102485"><span class="hs-identifier hs-var">dayIndex</span></a><span>
</span><a name="line-191"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">invigilatorWantDays</span><span> </span><a href="#local-6989586621679102490"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-192"></a><span>              </span><span class="hs-operator hs-var">||</span><span>     </span><a href="#local-6989586621679102485"><span class="hs-identifier hs-var">dayIndex</span></a><span>
</span><a name="line-193"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">invigilatorInvigilationDays</span><span> </span><a href="#local-6989586621679102490"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-194"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>          </span><a href="#local-6989586621679102487"><span class="hs-identifier hs-var">invigilators''</span></a><span>
</span><a name="line-196"></a><span>        </span><a name="local-6989586621679102489"><a href="#local-6989586621679102489"><span class="hs-identifier">canInvigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span>
</span><a name="line-197"></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679102491"><a href="#local-6989586621679102491"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-198"></a><span>            </span><a href="#local-6989586621679102485"><span class="hs-identifier hs-var">dayIndex</span></a><span>
</span><a name="line-199"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span>    </span><span class="hs-identifier">invigilatorCanDays</span><span> </span><a href="#local-6989586621679102491"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-200"></a><span>              </span><span class="hs-operator hs-var">&amp;&amp;</span><span>        </span><a href="#local-6989586621679102485"><span class="hs-identifier hs-var">dayIndex</span></a><span>
</span><a name="line-201"></a><span>              </span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">invigilatorInvigilationDays</span><span> </span><a href="#local-6989586621679102491"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-202"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>          </span><a href="#local-6989586621679102487"><span class="hs-identifier hs-var">invigilators''</span></a><span>
</span><a name="line-204"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679102488"><span class="hs-identifier hs-var">wantAndPlannedInvigs</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679102489"><span class="hs-identifier hs-var">canInvigs</span></a><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>  </span><span class="hs-identifier">examDays'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-207"></a><span>  </span><a name="local-6989586621679098248"><a href="#local-6989586621679098248"><span class="hs-identifier">examDays'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-208"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102492"><a href="#local-6989586621679102492"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-209"></a><span>    </span><a name="local-6989586621679102493"><a href="#local-6989586621679102493"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102492"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">examDaysAsStrings</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679102493"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-211"></a><span>
</span><a name="line-212"></a><span>  </span><span class="hs-identifier">slots'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-identifier hs-type">Slots</span><span>
</span><a name="line-213"></a><span>  </span><a name="local-6989586621679098249"><a href="#local-6989586621679098249"><span class="hs-identifier">slots'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-214"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102494"><a href="#local-6989586621679102494"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-215"></a><span>    </span><a name="local-6989586621679102495"><a href="#local-6989586621679102495"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102494"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-216"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679102495"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span>  </span><span class="hs-identifier">slot'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-219"></a><span>  </span><a name="local-6989586621679098250"><a href="#local-6989586621679098250"><span class="hs-identifier">slot'</span></a></a><span> </span><a name="local-6989586621679102496"><a href="#local-6989586621679102496"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-220"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102497"><a href="#local-6989586621679102497"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-221"></a><span>    </span><a name="local-6989586621679102498"><a href="#local-6989586621679102498"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102497"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">examsInSlot</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.lookup</span><span> </span><a href="#local-6989586621679102496"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679102498"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-223"></a><span>
</span><a name="line-224"></a><span>  </span><span class="hs-identifier">slotByRooms'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Room</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-225"></a><span>  </span><a name="local-6989586621679098251"><a href="#local-6989586621679098251"><span class="hs-identifier">slotByRooms'</span></a></a><span> </span><a name="local-6989586621679102499"><a href="#local-6989586621679102499"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-226"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102500"><a href="#local-6989586621679102500"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-227"></a><span>    </span><a name="local-6989586621679102501"><a href="#local-6989586621679102501"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102500"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">slotByRooms</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.lookup</span><span> </span><a href="#local-6989586621679102499"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679102501"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-identifier">slotsPerDay'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span>
</span><a name="line-231"></a><span>  </span><a name="local-6989586621679098252"><a href="#local-6989586621679098252"><span class="hs-identifier">slotsPerDay'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-232"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102502"><a href="#local-6989586621679102502"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-233"></a><span>    </span><a name="local-6989586621679102503"><a href="#local-6989586621679102503"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102502"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slotsPerDay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679102503"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span>  </span><span class="hs-identifier">slotsForDay'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-identifier hs-type">Slots</span><span>
</span><a name="line-237"></a><span>  </span><a name="local-6989586621679098253"><a href="#local-6989586621679098253"><span class="hs-identifier">slotsForDay'</span></a></a><span> </span><a name="local-6989586621679102504"><a href="#local-6989586621679102504"><span class="hs-identifier">dayIndex</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-238"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102505"><a href="#local-6989586621679102505"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-239"></a><span>    </span><a name="local-6989586621679102506"><a href="#local-6989586621679102506"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102505"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-240"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.filterWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679102507"><a href="#local-6989586621679102507"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679102507"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679102504"><span class="hs-identifier hs-var">dayIndex</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679102506"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-identifier">conflictingSlots'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ancode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>  </span><a name="local-6989586621679098254"><a href="#local-6989586621679098254"><span class="hs-identifier">conflictingSlots'</span></a></a><span> </span><a name="local-6989586621679102523"><a href="#local-6989586621679102523"><span class="hs-identifier">ancode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-244"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102524"><a href="#local-6989586621679102524"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-245"></a><span>    </span><a name="local-6989586621679102525"><a href="#local-6989586621679102525"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102524"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-246"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">conflictingSlotsForAncode</span><span> </span><a href="#local-6989586621679102523"><span class="hs-identifier hs-var">ancode</span></a><span> </span><a href="#local-6989586621679102525"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span>  </span><span class="hs-identifier">unscheduledExams'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-249"></a><span>  </span><a name="local-6989586621679098255"><a href="#local-6989586621679098255"><span class="hs-identifier">unscheduledExams'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-250"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102526"><a href="#local-6989586621679102526"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-251"></a><span>    </span><a name="local-6989586621679102527"><a href="#local-6989586621679102527"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102526"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-252"></a><span>    </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-253"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679102682"><a href="#local-6989586621679102682"><span class="hs-identifier">e1</span></a></a><span> </span><a name="local-6989586621679102683"><a href="#local-6989586621679102683"><span class="hs-identifier">e2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">compare</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">registrations</span><span> </span><a href="#local-6989586621679102683"><span class="hs-identifier hs-var">e2</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">registrations</span><span> </span><a href="#local-6989586621679102682"><span class="hs-identifier hs-var">e1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-identifier hs-var">isUnscheduled</span><span>
</span><a name="line-255"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">allExams</span><span> </span><a href="#local-6989586621679102527"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span>  </span><span class="hs-identifier">notPlannedByMeExams'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>  </span><a name="local-6989586621679098256"><a href="#local-6989586621679098256"><span class="hs-identifier">notPlannedByMeExams'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-259"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102684"><a href="#local-6989586621679102684"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-260"></a><span>    </span><a name="local-6989586621679102685"><a href="#local-6989586621679102685"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102684"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-261"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">importedExams</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679102685"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>  </span><span class="hs-identifier">examsBySameLecturer'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ancode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span>
</span><a name="line-264"></a><span>  </span><a name="local-6989586621679098257"><a href="#local-6989586621679098257"><span class="hs-identifier">examsBySameLecturer'</span></a></a><span> </span><a name="local-6989586621679102686"><a href="#local-6989586621679102686"><span class="hs-identifier">anCode'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-265"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102687"><a href="#local-6989586621679102687"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-266"></a><span>    </span><a name="local-6989586621679102688"><a href="#local-6989586621679102688"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102687"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-267"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679102689"><a href="#local-6989586621679102689"><span class="hs-identifier">allExams'</span></a></a><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">allExams</span><span> </span><a href="#local-6989586621679102688"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-268"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679102690"><a href="#local-6989586621679102690"><span class="hs-identifier">thisExam</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679102691"><a href="#local-6989586621679102691"><span class="hs-identifier">otherExams</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">partition</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679102686"><span class="hs-identifier hs-var">anCode'</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">anCode</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679102689"><span class="hs-identifier hs-var">allExams'</span></a><span>
</span><a name="line-269"></a><span>        </span><a name="local-6989586621679102692"><a href="#local-6989586621679102692"><span class="hs-identifier">lecturer''</span></a></a><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">personID</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">lecturer</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679102690"><span class="hs-identifier hs-var">thisExam</span></a><span>
</span><a name="line-270"></a><span>        </span><a name="local-6989586621679102693"><a href="#local-6989586621679102693"><span class="hs-identifier">otherExams'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679102692"><span class="hs-identifier hs-var">lecturer''</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">personID</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">lecturer</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679102691"><span class="hs-identifier hs-var">otherExams</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679102693"><span class="hs-identifier hs-var">otherExams'</span></a><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span>  </span><span class="hs-identifier">plannedRooms'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">PlannedRoomWithSlots</span><span class="hs-special">]</span><span>
</span><a name="line-274"></a><span>  </span><a name="local-6989586621679098258"><a href="#local-6989586621679098258"><span class="hs-identifier">plannedRooms'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-275"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102694"><a href="#local-6989586621679102694"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-276"></a><span>    </span><a name="local-6989586621679102695"><a href="#local-6989586621679102695"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102694"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-277"></a><span>    </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-278"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">queryRoomByID</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679102695"><span class="hs-identifier hs-var">plan''</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">availableRoomName</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">availableRooms</span><span>
</span><a name="line-280"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679102695"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span>  </span><span class="hs-identifier">validation'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidateWhat</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-identifier hs-type">Validation</span><span>
</span><a name="line-283"></a><span>  </span><a name="local-6989586621679098259"><a href="#local-6989586621679098259"><span class="hs-identifier">validation'</span></a></a><span> </span><a name="local-6989586621679102696"><a href="#local-6989586621679102696"><span class="hs-identifier">validateWhat''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-284"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102697"><a href="#local-6989586621679102697"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-285"></a><span>    </span><a name="local-6989586621679102698"><a href="#local-6989586621679102698"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102697"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-286"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-identifier hs-var">Validation</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">validate</span><span> </span><a href="#local-6989586621679102696"><span class="hs-identifier hs-var">validateWhat''</span></a><span> </span><a href="#local-6989586621679102698"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span>  </span><span class="hs-identifier">goSlots'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-289"></a><span>  </span><a name="local-6989586621679098260"><a href="#local-6989586621679098260"><span class="hs-identifier">goSlots'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-290"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102699"><a href="#local-6989586621679102699"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-291"></a><span>    </span><a name="local-6989586621679102700"><a href="#local-6989586621679102700"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102699"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-292"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">goSlots</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679102700"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-293"></a><span>
</span><a name="line-294"></a><span>  </span><span class="hs-identifier">lecturer'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Person</span><span class="hs-special">]</span><span>
</span><a name="line-295"></a><span>  </span><a name="local-6989586621679098261"><a href="#local-6989586621679098261"><span class="hs-identifier">lecturer'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-296"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102701"><a href="#local-6989586621679102701"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-297"></a><span>    </span><a name="local-6989586621679102702"><a href="#local-6989586621679102702"><span class="hs-identifier">plan''</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readTVarIO</span><span> </span><a href="#local-6989586621679102701"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-298"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span> </span><span class="hs-identifier">personShortName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">lecturer</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">allExams</span><span> </span><a href="#local-6989586621679102702"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-299"></a><span>
</span><a name="line-300"></a><span>  </span><span class="hs-identifier">addExam'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">AddExamToSlot</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>  </span><a name="local-6989586621679098262"><a href="#local-6989586621679098262"><span class="hs-identifier">addExam'</span></a></a><span> </span><a name="local-6989586621679102703"><a href="#local-6989586621679102703"><span class="hs-identifier">addExamToSlot'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-302"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679102704"><a href="#local-6989586621679102704"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-303"></a><span>    </span><a name="local-6989586621679102738"><a href="#local-6989586621679102738"><span class="hs-identifier">plan''''</span></a></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-304"></a><span>      </span><a name="local-6989586621679102705"><a href="#local-6989586621679102705"><span class="hs-identifier">plan''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readTVar</span><span> </span><a href="#local-6989586621679102704"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-305"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679102706"><a href="#local-6989586621679102706"><span class="hs-identifier">plan'''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">applyAddExamToSlotListToPlan</span><span> </span><a href="#local-6989586621679102705"><span class="hs-identifier hs-var">plan''</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679102703"><span class="hs-identifier hs-var">addExamToSlot'</span></a><span class="hs-special">]</span><span>
</span><a name="line-306"></a><span>      </span><span class="hs-identifier hs-var">writeTVar</span><span> </span><a href="#local-6989586621679102704"><span class="hs-identifier hs-var">planT</span></a><span> </span><a href="#local-6989586621679102706"><span class="hs-identifier hs-var">plan'''</span></a><span>
</span><a name="line-307"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679102706"><span class="hs-identifier hs-var">plan'''</span></a><span>
</span><a name="line-308"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679102739"><a href="#local-6989586621679102739"><span class="hs-identifier">planManipFile'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">planManipFile</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">files</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679102738"><span class="hs-identifier hs-var">plan''''</span></a><span>
</span><a name="line-309"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679102739"><span class="hs-identifier hs-var">planManipFile'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-310"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679102740"><a href="#local-6989586621679102740"><span class="hs-identifier">planManipFile''</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-311"></a><span>        </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">updatePlanManipFile</span><span> </span><a href="#local-6989586621679102740"><span class="hs-identifier hs-var">planManipFile''</span></a><span> </span><a href="#local-6989586621679102703"><span class="hs-identifier hs-var">addExamToSlot'</span></a><span>
</span><a name="line-312"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-313"></a><span>        </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;error while trying to add &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679102703"><span class="hs-identifier hs-var">addExamToSlot'</span></a><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span>  </span><span class="hs-identifier">addInvigilator</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">AddInvigilatorToRoomOrSlot</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>  </span><a name="local-6989586621679098263"><a href="#local-6989586621679098263"><span class="hs-identifier">addInvigilator</span></a></a><span> </span><a name="local-6989586621679103543"><a href="#local-6989586621679103543"><span class="hs-identifier">addinvig</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AddInvigilatorToRoomOrSlot</span><span> </span><a name="local-6989586621679103544"><a href="#local-6989586621679103544"><span class="hs-identifier">invigID</span></a></a><span> </span><a name="local-6989586621679103545"><a href="#local-6989586621679103545"><span class="hs-identifier">invigSlot</span></a></a><span> </span><a name="local-6989586621679103546"><a href="#local-6989586621679103546"><span class="hs-identifier">invigRoom</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-317"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-318"></a><span>      </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679103547"><a href="#local-6989586621679103547"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-319"></a><span>      </span><a name="local-6989586621679103618"><a href="#local-6989586621679103618"><span class="hs-identifier">plan''''</span></a></a><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-320"></a><span>        </span><a name="local-6989586621679103548"><a href="#local-6989586621679103548"><span class="hs-identifier">plan''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readTVar</span><span> </span><a href="#local-6989586621679103547"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-321"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679103549"><a href="#local-6989586621679103549"><span class="hs-identifier">plan'''</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-322"></a><span>              </span><span class="hs-identifier hs-var">addInvigilatorToExamOrSlot</span><span> </span><a href="#local-6989586621679103544"><span class="hs-identifier hs-var">invigID</span></a><span> </span><a href="#local-6989586621679103545"><span class="hs-identifier hs-var">invigSlot</span></a><span> </span><a href="#local-6989586621679103546"><span class="hs-identifier hs-var">invigRoom</span></a><span> </span><a href="#local-6989586621679103548"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-323"></a><span>        </span><span class="hs-identifier hs-var">writeTVar</span><span> </span><a href="#local-6989586621679103547"><span class="hs-identifier hs-var">planT</span></a><span> </span><a href="#local-6989586621679103549"><span class="hs-identifier hs-var">plan'''</span></a><span>
</span><a name="line-324"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679103549"><span class="hs-identifier hs-var">plan'''</span></a><span>
</span><a name="line-325"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679103619"><a href="#local-6989586621679103619"><span class="hs-identifier">invigilationsFile'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-326"></a><span>            </span><span class="hs-identifier">invigilationsFile</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">files</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679103618"><span class="hs-identifier hs-var">plan''''</span></a><span>
</span><a name="line-327"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679103619"><span class="hs-identifier hs-var">invigilationsFile'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-328"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679103620"><a href="#local-6989586621679103620"><span class="hs-identifier">invigilationsFile''</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-329"></a><span>          </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">updateInvigilationFile</span><span> </span><a href="#local-6989586621679103620"><span class="hs-identifier hs-var">invigilationsFile''</span></a><span> </span><a href="#local-6989586621679103543"><span class="hs-identifier hs-var">addinvig</span></a><span>
</span><a name="line-330"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-331"></a><span>          </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">putStrLn</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;error while trying to add &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679103543"><span class="hs-identifier hs-var">addinvig</span></a><span>
</span><a name="line-332"></a><span>
</span><a name="line-333"></a><span>  </span><span class="hs-identifier">removeInvigilator</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">RemoveInvigilatorFromRoomOrSlot</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>  </span><a name="local-6989586621679098264"><a href="#local-6989586621679098264"><span class="hs-identifier">removeInvigilator</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">RemoveInvigilatorFromRoomOrSlot</span><span> </span><a name="local-6989586621679103621"><a href="#local-6989586621679103621"><span class="hs-identifier">invigID</span></a></a><span> </span><a name="local-6989586621679103622"><a href="#local-6989586621679103622"><span class="hs-identifier">invigSlot</span></a></a><span> </span><a name="local-6989586621679103623"><a href="#local-6989586621679103623"><span class="hs-identifier">invigRoom</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-336"></a><span>      </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679103624"><a href="#local-6989586621679103624"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-337"></a><span>      </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-338"></a><span>        </span><a name="local-6989586621679103625"><a href="#local-6989586621679103625"><span class="hs-identifier">plan''</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readTVar</span><span> </span><a href="#local-6989586621679103624"><span class="hs-identifier hs-var">planT</span></a><span>
</span><a name="line-339"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679103626"><a href="#local-6989586621679103626"><span class="hs-identifier">plan'''</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-340"></a><span>              </span><span class="hs-identifier hs-var">removeInvigilatorFromExamOrSlot</span><span> </span><a href="#local-6989586621679103621"><span class="hs-identifier hs-var">invigID</span></a><span> </span><a href="#local-6989586621679103622"><span class="hs-identifier hs-var">invigSlot</span></a><span> </span><a href="#local-6989586621679103623"><span class="hs-identifier hs-var">invigRoom</span></a><span> </span><a href="#local-6989586621679103625"><span class="hs-identifier hs-var">plan''</span></a><span>
</span><a name="line-341"></a><span>        </span><span class="hs-identifier hs-var">writeTVar</span><span> </span><a href="#local-6989586621679103624"><span class="hs-identifier hs-var">planT</span></a><span> </span><a href="#local-6989586621679103626"><span class="hs-identifier hs-var">plan'''</span></a><span>
</span><a name="line-342"></a><span>
</span><a name="line-343"></a><span>  </span><span class="hs-identifier">reloadPlan'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Plexams.Server.Server.html#StateHandler"><span class="hs-identifier hs-type">StateHandler</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-344"></a><span>  </span><a name="local-6989586621679098265"><a href="#local-6989586621679098265"><span class="hs-identifier">reloadPlan'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-345"></a><span>    </span><a href="Plexams.Server.Server.html#State"><span class="hs-identifier hs-var">State</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">plan</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679103627"><a href="#local-6989586621679103627"><span class="hs-identifier">planT</span></a></a><span> </span><span class="hs-special">}</span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">ask</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679103628"><a href="#local-6989586621679103628"><span class="hs-identifier">maybePlan</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679103629"><a href="#local-6989586621679103629"><span class="hs-identifier">errorMessages</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-identifier hs-var">importPlan</span><span>
</span><a name="line-347"></a><span>    </span><a name="local-6989586621679103631"><a href="#local-6989586621679103631"><span class="hs-identifier">newPlanSet</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679103628"><span class="hs-identifier hs-var">maybePlan</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-348"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-349"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679103630"><a href="#local-6989586621679103630"><span class="hs-identifier">newPlan</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-350"></a><span>        </span><span class="hs-identifier hs-var">writeTVar</span><span> </span><a href="#local-6989586621679103627"><span class="hs-identifier hs-var">planT</span></a><span> </span><a href="#local-6989586621679103630"><span class="hs-identifier hs-var">newPlan</span></a><span>
</span><a name="line-351"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-352"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679103631"><span class="hs-identifier hs-var">newPlanSet</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679103629"><span class="hs-identifier hs-var">errorMessages</span></a><span class="hs-special">)</span><span>
</span><a name="line-353"></a></pre></body></html>