<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plexams.Validation.ScheduledExams</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validate"><span class="hs-identifier hs-var">validate</span></a><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span class="hs-keyword">where</span><span>
</span><a name="line-7"></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Arrow</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">second</span><span>
</span><a name="line-10"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Writer</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.List</span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">intersect</span><span>
</span><a name="line-13"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">nub</span><span>
</span><a name="line-14"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                      </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span>                     </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">isJust</span><span>
</span><a name="line-17"></a><span>                                                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span>
</span><a name="line-18"></a><span>                                                </span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-comment">-- import qualified Data.Set as S</span><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Text</span><span>                      </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">append</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text</span><span>                     </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Text</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Exts</span><span>                       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">groupWith</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">TextShow</span><span>                       </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Query</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Plexams.Types</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-identifier">validate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-31"></a><a name="validate"><a href="Plexams.Validation.ScheduledExams.html#validate"><span class="hs-identifier">validate</span></a></a><span> </span><a name="local-6989586621679059055"><a href="#local-6989586621679059055"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;## Validating Schedule&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-33"></a><span>  </span><a name="local-6989586621679059056"><a href="#local-6989586621679059056"><span class="hs-identifier">constraintsOk</span></a></a><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateScheduleConstraints"><span class="hs-identifier hs-var">validateScheduleConstraints</span></a><span> </span><a href="#local-6989586621679059055"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-34"></a><span>  </span><a name="local-6989586621679059057"><a href="#local-6989586621679059057"><span class="hs-identifier">goSlotsOk</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateGOSlots"><span class="hs-identifier hs-var">validateGOSlots</span></a><span> </span><a href="#local-6989586621679059055"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-35"></a><span>  </span><a name="local-6989586621679059058"><a href="#local-6989586621679059058"><span class="hs-identifier">sameNameSameSlot</span></a></a><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateSameNameSameSlot"><span class="hs-identifier hs-var">validateSameNameSameSlot</span></a><span> </span><a href="#local-6989586621679059055"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-36"></a><span>  </span><a name="local-6989586621679059059"><a href="#local-6989586621679059059"><span class="hs-identifier">conflicts</span></a></a><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateConflicts"><span class="hs-identifier hs-var">validateConflicts</span></a><span> </span><a href="#local-6989586621679059055"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-37"></a><span>  </span><span class="hs-comment">-- sameSlotOverlaps &lt;- validateOverlapsInSameSlot plan</span><span>
</span><a name="line-38"></a><span>  </span><span class="hs-comment">-- adjacentSlotOverlaps &lt;- validateOverlapsInAdjacentSlots plan</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-comment">-- sameDayOverlaps &lt;- validateOverlapsSameDay plan</span><span>
</span><a name="line-40"></a><span>  </span><a name="local-6989586621679059060"><a href="#local-6989586621679059060"><span class="hs-identifier">lecturerMaxOneExamPerSlot</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateLecturerMaxOneExamPerSlot"><span class="hs-identifier hs-var">validateLecturerMaxOneExamPerSlot</span></a><span> </span><a href="#local-6989586621679059055"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-41"></a><span>  </span><a name="local-6989586621679059061"><a href="#local-6989586621679059061"><span class="hs-identifier">studentsMaxTwoExamsPerDay</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateStudentsMaxTwoExamsPerDay"><span class="hs-identifier hs-var">validateStudentsMaxTwoExamsPerDay</span></a><span> </span><a href="#local-6989586621679059055"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">validationResult</span><span>
</span><a name="line-43"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679059056"><span class="hs-identifier hs-var">constraintsOk</span></a><span>
</span><a name="line-44"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679059057"><span class="hs-identifier hs-var">goSlotsOk</span></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679059058"><span class="hs-identifier hs-var">sameNameSameSlot</span></a><span>
</span><a name="line-46"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679059059"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-47"></a><span>            </span><span class="hs-comment">-- , sameSlotOverlaps</span><span>
</span><a name="line-48"></a><span>            </span><span class="hs-comment">-- , sameDayOverlaps</span><span>
</span><a name="line-49"></a><span>            </span><span class="hs-comment">-- , adjacentSlotOverlaps</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679059060"><span class="hs-identifier hs-var">lecturerMaxOneExamPerSlot</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679059061"><span class="hs-identifier hs-var">studentsMaxTwoExamsPerDay</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-identifier">validateGOSlots</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-55"></a><a name="validateGOSlots"><a href="Plexams.Validation.ScheduledExams.html#validateGOSlots"><span class="hs-identifier">validateGOSlots</span></a></a><span> </span><a name="local-6989586621679059062"><a href="#local-6989586621679059062"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-56"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Checking GO-Slots! (hard)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-57"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679059063"><a href="#local-6989586621679059063"><span class="hs-identifier">allowedSlots</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">goSlots</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">semesterConfig</span><span> </span><a href="#local-6989586621679059062"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-58"></a><span>      </span><a name="local-6989586621679059064"><a href="#local-6989586621679059064"><span class="hs-identifier">examsInOtherSlots</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-59"></a><span>        </span><span class="hs-identifier hs-var">filter</span><span>
</span><a name="line-60"></a><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679059447"><a href="#local-6989586621679059447"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">elem</span><span> </span><span class="hs-string">&quot;GO&quot;</span><span> </span><a href="#local-6989586621679059447"><span class="hs-identifier hs-var">gs</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><span class="hs-identifier hs-var">elem</span><span> </span><span class="hs-string">&quot;GN&quot;</span><span> </span><a href="#local-6989586621679059447"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">registeredGroupDegree</span><span>
</span><a name="line-62"></a><span>            </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">registeredGroups</span><span>
</span><a name="line-63"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">examsInSlot</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">M.lookup</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679059062"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679059063"><span class="hs-identifier hs-var">allowedSlots</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.keys</span><span>
</span><a name="line-68"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679059062"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-69"></a><span>      </span><a name="local-6989586621679059065"><a href="#local-6989586621679059065"><span class="hs-identifier">goOk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679059064"><span class="hs-identifier hs-var">examsInOtherSlots</span></a><span>
</span><a name="line-70"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679059065"><span class="hs-identifier hs-var">goOk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679059064"><span class="hs-identifier hs-var">examsInOtherSlots</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679060384"><a href="#local-6989586621679060384"><span class="hs-identifier">exam</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span>
</span><a name="line-72"></a><span>      </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;- GO exam &quot;</span><span>
</span><a name="line-73"></a><span>      </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">anCode</span><span> </span><a href="#local-6989586621679060384"><span class="hs-identifier hs-var">exam</span></a><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>      </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; in wrong slot&quot;</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679059065"><span class="hs-identifier hs-var">goOk</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-identifier">validateSameNameSameSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-79"></a><a name="validateSameNameSameSlot"><a href="Plexams.Validation.ScheduledExams.html#validateSameNameSameSlot"><span class="hs-identifier">validateSameNameSameSlot</span></a></a><span> </span><a name="local-6989586621679060385"><a href="#local-6989586621679060385"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060386"><a href="#local-6989586621679060386"><span class="hs-identifier">examsGroupedByNameWithDifferentSlots</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-81"></a><span>        </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">slot</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">groupWith</span><span> </span><span class="hs-identifier">name</span><span>
</span><a name="line-83"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span>
</span><a name="line-84"></a><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">notOnSameDay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">constraints</span><span> </span><a href="#local-6989586621679060385"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">anCode</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>          </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">allExams</span><span> </span><a href="#local-6989586621679060385"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-86"></a><span>      </span><a name="local-6989586621679060387"><a href="#local-6989586621679060387"><span class="hs-identifier">ok</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060386"><span class="hs-identifier hs-var">examsGroupedByNameWithDifferentSlots</span></a><span>
</span><a name="line-87"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Checking exams with same name in same slot (hard)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679060387"><span class="hs-identifier hs-var">ok</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span>
</span><a name="line-89"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;- exams with same name but different slots: &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showt</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">anCode</span><span> </span><span class="hs-operator hs-var">&amp;&amp;&amp;</span><span> </span><span class="hs-identifier">slot</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>    </span><a href="#local-6989586621679060386"><span class="hs-identifier hs-var">examsGroupedByNameWithDifferentSlots</span></a><span>
</span><a name="line-97"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060387"><span class="hs-identifier hs-var">ok</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- validate conflicts (should replace validate overlaps)</span><span>
</span><a name="line-101"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-102"></a><span class="hs-identifier">validateConflicts</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-103"></a><a name="validateConflicts"><a href="Plexams.Validation.ScheduledExams.html#validateConflicts"><span class="hs-identifier">validateConflicts</span></a></a><span> </span><a name="local-6989586621679060388"><a href="#local-6989586621679060388"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Checking conflicts in same slot (hard)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-105"></a><span>  </span><a name="local-6989586621679060389"><a href="#local-6989586621679060389"><span class="hs-identifier">sameSlotsOk</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">examsInSlot</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679060388"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>                      </span><span class="hs-special">(</span><a href="Plexams.Validation.ScheduledExams.html#validateConflicts%27"><span class="hs-identifier hs-var">validateConflicts'</span></a><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Checking conflicts in adjacent slot (hard)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-108"></a><span>  </span><a name="local-6989586621679060390"><a href="#local-6989586621679060390"><span class="hs-identifier">adjacentSlotsOk</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-identifier hs-var">forM</span><span>
</span><a name="line-110"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">examsInSlot</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">adjacentSlotPairs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span>
</span><a name="line-111"></a><span>          </span><a href="#local-6989586621679060388"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-112"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateConflicts%27"><span class="hs-identifier hs-var">validateConflicts'</span></a><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Checking conflicts on same day (soft)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-115"></a><span>  </span><a name="local-6989586621679060391"><a href="#local-6989586621679060391"><span class="hs-identifier">daySlotsOk</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-identifier hs-var">forM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.elems</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">examsInSlot</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">slotsByDay</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679060388"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>      </span><span class="hs-operator hs-var">$</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateConflicts%27"><span class="hs-identifier hs-var">validateConflicts'</span></a><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">validationResult</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679060389"><span class="hs-identifier hs-var">sameSlotsOk</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060390"><span class="hs-identifier hs-var">adjacentSlotsOk</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060391"><span class="hs-identifier hs-var">daySlotsOk</span></a><span class="hs-special">]</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-identifier">validateConflicts'</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-type">DayIndex</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SlotIndex</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Exam</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-123"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-124"></a><a name="validateConflicts%27"><a href="Plexams.Validation.ScheduledExams.html#validateConflicts%27"><span class="hs-identifier">validateConflicts'</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-125"></a><span class="hs-identifier">validateConflicts'</span><span> </span><a name="local-6989586621679060392"><a href="#local-6989586621679060392"><span class="hs-identifier">hard</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679060393"><a href="#local-6989586621679060393"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060394"><a href="#local-6989586621679060394"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679060395"><a href="#local-6989586621679060395"><span class="hs-identifier">es</span></a></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-126"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060396"><a href="#local-6989586621679060396"><span class="hs-identifier">conflicts</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-127"></a><span>        </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">anCode</span><span> </span><a href="#local-6989586621679060395"><span class="hs-identifier hs-var">es</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">intersect</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.keys</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">conflictingAncodes</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060395"><span class="hs-identifier hs-var">es</span></a><span>
</span><a name="line-128"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060396"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-129"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-131"></a><span>      </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-132"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060392"><span class="hs-identifier hs-var">hard</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">SoftConstraintBroken</span><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span>          </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;- Conflict in slot (&quot;</span><span>
</span><a name="line-134"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060393"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-135"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;, &quot;</span><span>
</span><a name="line-136"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060394"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-137"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot;): &quot;</span><span>
</span><a name="line-138"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">Text.intercalate</span><span> </span><span class="hs-string">&quot;, &quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060396"><span class="hs-identifier hs-var">conflicts</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-140"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060392"><span class="hs-identifier hs-var">hard</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">SoftConstraintsBroken</span><span>
</span><a name="line-141"></a><span class="hs-identifier">validateConflicts'</span><span> </span><a name="local-6989586621679060397"><a href="#local-6989586621679060397"><span class="hs-identifier">hard</span></a></a><span> </span><a name="local-6989586621679060398"><a href="#local-6989586621679060398"><span class="hs-identifier">slotsAndExams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-143"></a><span>    </span><a name="local-6989586621679060399"><a href="#local-6989586621679060399"><span class="hs-identifier">ancodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">anCode</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060398"><span class="hs-identifier hs-var">slotsAndExams</span></a><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679060400"><a href="#local-6989586621679060400"><span class="hs-identifier">conflictingancodes</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-145"></a><span>      </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">M.keys</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">conflictingAncodes</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060398"><span class="hs-identifier hs-var">slotsAndExams</span></a><span>
</span><a name="line-146"></a><span>    </span><a name="local-6989586621679060401"><a href="#local-6989586621679060401"><span class="hs-identifier">conflicts</span></a></a><span>                  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679060399"><span class="hs-identifier hs-var">ancodes</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">intersect</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><a href="#local-6989586621679060400"><span class="hs-identifier hs-var">conflictingancodes</span></a><span>
</span><a name="line-147"></a><span>    </span><a name="local-6989586621679060402"><a href="#local-6989586621679060402"><span class="hs-identifier">conflictingAncodesWithSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span>
</span><a name="line-148"></a><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679060403"><a href="#local-6989586621679060403"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><a href="#local-6989586621679060403"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-149"></a><span>        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">elem</span><span> </span><a href="#local-6989586621679060403"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">anCode</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060398"><span class="hs-identifier hs-var">slotsAndExams</span></a><span>
</span><a name="line-150"></a><span>      </span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>      </span><a href="#local-6989586621679060401"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-152"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060401"><span class="hs-identifier hs-var">conflicts</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-155"></a><span>      </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679060398"><span class="hs-identifier hs-var">slotsAndExams</span></a><span class="hs-special">]</span><span>
</span><a name="line-156"></a><span>      </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-157"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060397"><span class="hs-identifier hs-var">hard</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">SoftConstraintBroken</span><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>          </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;- Conflict in slots: &quot;</span><span>
</span><a name="line-159"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060402"><span class="hs-identifier hs-var">conflictingAncodesWithSlot</span></a><span>
</span><a name="line-160"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-161"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060397"><span class="hs-identifier hs-var">hard</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">SoftConstraintsBroken</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">-- --------------------------------------------------------------------------------</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- -- validate overlaps (should be replaced by validate conflicts)</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- --------------------------------------------------------------------------------</span><span>
</span><a name="line-166"></a><span class="hs-comment">--</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- validateOverlapsInSameSlot :: Plan -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- validateOverlapsInSameSlot plan = do</span><span>
</span><a name="line-169"></a><span class="hs-comment">--   tell [Info &quot;### Checking overlaps in same slot (hard)&quot;]</span><span>
</span><a name="line-170"></a><span class="hs-comment">--   validateOverlaps (overlaps $ constraints plan)</span><span>
</span><a name="line-171"></a><span class="hs-comment">--                    (map (M.elems . examsInSlot) $ M.elems $ slots plan)</span><span>
</span><a name="line-172"></a><span class="hs-comment">--</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- validateOverlaps :: [Overlaps] -&gt; [[Exam]]</span><span>
</span><a name="line-174"></a><span class="hs-comment">--                  -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- validateOverlaps [] _ = do</span><span>
</span><a name="line-176"></a><span class="hs-comment">--   tell [Info &quot;#### no overlaps found&quot;]</span><span>
</span><a name="line-177"></a><span class="hs-comment">--   return EverythingOk</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- validateOverlaps overlaps' exams' =</span><span>
</span><a name="line-179"></a><span class="hs-comment">--   validationResult &lt;$&gt; mapM (validateOverlapsForExams overlaps') exams'</span><span>
</span><a name="line-180"></a><span class="hs-comment">--</span><span>
</span><a name="line-181"></a><span class="hs-comment">-- validateOverlapsForExams :: [Overlaps] -&gt; [Exam]</span><span>
</span><a name="line-182"></a><span class="hs-comment">--                          -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-183"></a><span class="hs-comment">-- validateOverlapsForExams overlaps' exams' =</span><span>
</span><a name="line-184"></a><span class="hs-comment">--   validationResult &lt;$&gt; mapM (`validateOverlapsForExams'` exams') overlaps'</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">-- validateOverlapsForExams' :: Overlaps -&gt; [Exam]</span><span>
</span><a name="line-187"></a><span class="hs-comment">--                           -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- validateOverlapsForExams' _ [] = return EverythingOk</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- validateOverlapsForExams' overlaps' (exam:exams') = do</span><span>
</span><a name="line-190"></a><span class="hs-comment">--   examOk &lt;- validateOverlapsForExam overlaps' exam exams' True</span><span>
</span><a name="line-191"></a><span class="hs-comment">--   tailOk &lt;- validateOverlapsForExams' overlaps' exams'</span><span>
</span><a name="line-192"></a><span class="hs-comment">--   return $ validationResult [examOk, tailOk]</span><span>
</span><a name="line-193"></a><span class="hs-comment">--</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- validateOverlapsInAdjacentSlots :: Plan -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- validateOverlapsInAdjacentSlots plan = do</span><span>
</span><a name="line-196"></a><span class="hs-comment">--   tell [Info &quot;### Checking overlaps in adjacent slots (hard)&quot;]</span><span>
</span><a name="line-197"></a><span class="hs-comment">--   let maxDays  = (\x -&gt; x-1) $ length $ examDays $ semesterConfig plan</span><span>
</span><a name="line-198"></a><span class="hs-comment">--       maxSlots = (\x -&gt; x-1) $ length $ slotsPerDay $ semesterConfig plan</span><span>
</span><a name="line-199"></a><span class="hs-comment">--       daySlotPairs = [ (d,(i,j)) | d &lt;- [0..maxDays]</span><span>
</span><a name="line-200"></a><span class="hs-comment">--                                  , (i,j) &lt;- zip [0..] [1..maxSlots] ]</span><span>
</span><a name="line-201"></a><span class="hs-comment">--       examsList (d,i) =</span><span>
</span><a name="line-202"></a><span class="hs-comment">--         M.elems $ maybe M.empty examsInSlot $ M.lookup (d,i) $ slots plan</span><span>
</span><a name="line-203"></a><span class="hs-comment">--       exams' = map (\(d,(i,j)) -&gt;  (examsList (d,i), examsList (d,j)))</span><span>
</span><a name="line-204"></a><span class="hs-comment">--                   daySlotPairs</span><span>
</span><a name="line-205"></a><span class="hs-comment">--   validateOverlapsTwoLists (overlaps $ constraints plan) exams' True</span><span>
</span><a name="line-206"></a><span class="hs-comment">--</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- validateOverlapsSameDay :: Plan -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-208"></a><span class="hs-comment">-- validateOverlapsSameDay plan = do</span><span>
</span><a name="line-209"></a><span class="hs-comment">--   tell [Info &quot;### Checking overlaps on same day (soft)&quot;]</span><span>
</span><a name="line-210"></a><span class="hs-comment">--   let maxDays  = (\x -&gt; x-1) $ length $ examDays $ semesterConfig plan</span><span>
</span><a name="line-211"></a><span class="hs-comment">--       maxSlots = (\x -&gt; x-1) $ length $ slotsPerDay $ semesterConfig plan</span><span>
</span><a name="line-212"></a><span class="hs-comment">--       daySlotPairs = [ (d,(i,j)) | d &lt;- [0..maxDays]</span><span>
</span><a name="line-213"></a><span class="hs-comment">--                                  , i &lt;- [0..maxSlots - 2]</span><span>
</span><a name="line-214"></a><span class="hs-comment">--                                  , j &lt;- [i+2..maxSlots]</span><span>
</span><a name="line-215"></a><span class="hs-comment">--                      ]</span><span>
</span><a name="line-216"></a><span class="hs-comment">--       examsList (d,i) =</span><span>
</span><a name="line-217"></a><span class="hs-comment">--         M.elems $ maybe M.empty examsInSlot $ M.lookup (d,i) $ slots plan</span><span>
</span><a name="line-218"></a><span class="hs-comment">--       exams' = map (\(d,(i,j)) -&gt;  (examsList (d,i), examsList (d,j)))</span><span>
</span><a name="line-219"></a><span class="hs-comment">--                   daySlotPairs</span><span>
</span><a name="line-220"></a><span class="hs-comment">--   valRes &lt;- validateOverlapsTwoLists (overlaps $ constraints plan) exams' False</span><span>
</span><a name="line-221"></a><span class="hs-comment">--   return $ case valRes of</span><span>
</span><a name="line-222"></a><span class="hs-comment">--     HardConstraintsBroken -&gt; SoftConstraintsBroken</span><span>
</span><a name="line-223"></a><span class="hs-comment">--     _                     -&gt; valRes</span><span>
</span><a name="line-224"></a><span class="hs-comment">--</span><span>
</span><a name="line-225"></a><span class="hs-comment">-- validateOverlapsTwoLists :: [Overlaps] -&gt; [([Exam],[Exam])] -&gt; Bool</span><span>
</span><a name="line-226"></a><span class="hs-comment">--                  -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-227"></a><span class="hs-comment">-- validateOverlapsTwoLists [] _ _ = do</span><span>
</span><a name="line-228"></a><span class="hs-comment">--   tell [Info &quot;#### no overlaps found&quot;]</span><span>
</span><a name="line-229"></a><span class="hs-comment">--   return EverythingOk</span><span>
</span><a name="line-230"></a><span class="hs-comment">-- validateOverlapsTwoLists overlaps' exams' hard =</span><span>
</span><a name="line-231"></a><span class="hs-comment">--   validationResult &lt;$&gt; mapM (validateOverlapsTwoListsForExams overlaps' hard) exams'</span><span>
</span><a name="line-232"></a><span class="hs-comment">--</span><span>
</span><a name="line-233"></a><span class="hs-comment">-- validateOverlapsTwoListsForExams :: [Overlaps] -&gt; Bool -&gt; ([Exam],[Exam])</span><span>
</span><a name="line-234"></a><span class="hs-comment">--                                  -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-235"></a><span class="hs-comment">-- validateOverlapsTwoListsForExams overlaps' hard (ex1, ex2) =</span><span>
</span><a name="line-236"></a><span class="hs-comment">--   validationResult</span><span>
</span><a name="line-237"></a><span class="hs-comment">--     &lt;$&gt; mapM (validateOverlapsTwoListsForExams' ex1 ex2 hard) overlaps'</span><span>
</span><a name="line-238"></a><span class="hs-comment">--</span><span>
</span><a name="line-239"></a><span class="hs-comment">-- validateOverlapsTwoListsForExams' :: [Exam] -&gt; [Exam] -&gt; Bool -&gt; Overlaps</span><span>
</span><a name="line-240"></a><span class="hs-comment">--                                   -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-241"></a><span class="hs-comment">-- validateOverlapsTwoListsForExams' [] _ _ _ = return EverythingOk</span><span>
</span><a name="line-242"></a><span class="hs-comment">-- validateOverlapsTwoListsForExams' (exam:exams') otherExams hard overlaps' = do</span><span>
</span><a name="line-243"></a><span class="hs-comment">--   examOk &lt;- validateOverlapsForExam overlaps' exam otherExams hard</span><span>
</span><a name="line-244"></a><span class="hs-comment">--   tailOk &lt;- validateOverlapsTwoListsForExams' exams' otherExams hard overlaps'</span><span>
</span><a name="line-245"></a><span class="hs-comment">--   return $ validationResult [ examOk, tailOk ]</span><span>
</span><a name="line-246"></a><span class="hs-comment">--</span><span>
</span><a name="line-247"></a><span class="hs-comment">-- validateOverlapsForExam :: Overlaps -&gt; Exam -&gt; [Exam] -&gt; Bool</span><span>
</span><a name="line-248"></a><span class="hs-comment">--                         -&gt; Writer [ValidationRecord] ValidationResult</span><span>
</span><a name="line-249"></a><span class="hs-comment">-- validateOverlapsForExam _        _    []    _ = return EverythingOk</span><span>
</span><a name="line-250"></a><span class="hs-comment">-- validateOverlapsForExam overlaps' exam exams' hard = do</span><span>
</span><a name="line-251"></a><span class="hs-comment">--   let overlapsForExam =</span><span>
</span><a name="line-252"></a><span class="hs-comment">--         M.findWithDefault M.empty (anCode exam) $ olOverlaps overlaps'</span><span>
</span><a name="line-253"></a><span class="hs-comment">--       overlappingExams =</span><span>
</span><a name="line-254"></a><span class="hs-comment">--         filter (isJust . snd)</span><span>
</span><a name="line-255"></a><span class="hs-comment">--         $ map ((\ancode -&gt; (ancode , M.lookup ancode overlapsForExam)) . anCode)</span><span>
</span><a name="line-256"></a><span class="hs-comment">--               exams'</span><span>
</span><a name="line-257"></a><span class="hs-comment">--       ok = null overlappingExams</span><span>
</span><a name="line-258"></a><span class="hs-comment">--   forM_ overlappingExams $ \(other, Just studs) -&gt;</span><span>
</span><a name="line-259"></a><span class="hs-comment">--     tell [ (if hard then HardConstraintBroken else SoftConstraintBroken)</span><span>
</span><a name="line-260"></a><span class="hs-comment">--          $ &quot;-   &quot; `append` showt (olGroup overlaps')</span><span>
</span><a name="line-261"></a><span class="hs-comment">--            `append` &quot;: Exam &quot; `append` showt (anCode exam)</span><span>
</span><a name="line-262"></a><span class="hs-comment">--            `append` &quot; overlaps with exam &quot; `append` showt other</span><span>
</span><a name="line-263"></a><span class="hs-comment">--            `append` &quot; for &quot; `append` showt studs `append` &quot; Students&quot;]</span><span>
</span><a name="line-264"></a><span class="hs-comment">--   return $ if ok then EverythingOk</span><span>
</span><a name="line-265"></a><span class="hs-comment">--           else if hard then HardConstraintsBroken else SoftConstraintsBroken</span><span>
</span><a name="line-266"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-267"></a><span class="hs-comment">-- validate constraints from constraints file</span><span>
</span><a name="line-268"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-269"></a><span class="hs-identifier">validateScheduleConstraints</span><span>
</span><a name="line-270"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-271"></a><a name="validateScheduleConstraints"><a href="Plexams.Validation.ScheduledExams.html#validateScheduleConstraints"><span class="hs-identifier">validateScheduleConstraints</span></a></a><span> </span><a name="local-6989586621679060404"><a href="#local-6989586621679060404"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-272"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;## Validate schedule constraints from file&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-273"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060405"><a href="#local-6989586621679060405"><span class="hs-identifier">constraints'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">constraints</span><span> </span><a href="#local-6989586621679060404"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-274"></a><span>  </span><a name="local-6989586621679060406"><a href="#local-6989586621679060406"><span class="hs-identifier">notOnSameDayOk</span></a></a><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateNotOnSameDay"><span class="hs-identifier hs-var">validateNotOnSameDay</span></a><span> </span><a href="#local-6989586621679060404"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">notOnSameDay</span><span> </span><a href="#local-6989586621679060405"><span class="hs-identifier hs-var">constraints'</span></a><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>  </span><a name="local-6989586621679060407"><a href="#local-6989586621679060407"><span class="hs-identifier">inSameSlotOk</span></a></a><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateInSameSlot"><span class="hs-identifier hs-var">validateInSameSlot</span></a><span> </span><a href="#local-6989586621679060404"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">inSameSlot</span><span> </span><a href="#local-6989586621679060405"><span class="hs-identifier hs-var">constraints'</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>  </span><a name="local-6989586621679060408"><a href="#local-6989586621679060408"><span class="hs-identifier">onOneOfTheseDaysOk</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateOneOfTheseDays"><span class="hs-identifier hs-var">validateOneOfTheseDays</span></a><span> </span><a href="#local-6989586621679060404"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-277"></a><span>                                               </span><span class="hs-special">(</span><span class="hs-identifier">onOneOfTheseDays</span><span> </span><a href="#local-6989586621679060405"><span class="hs-identifier hs-var">constraints'</span></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Plexams.Validation.ScheduledExams.html#validateFixSlot"><span class="hs-identifier hs-var">validateFixSlot</span></a><span> </span><a href="#local-6989586621679060404"><span class="hs-identifier hs-var">plan</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">fixedSlot</span><span> </span><a href="#local-6989586621679060405"><span class="hs-identifier hs-var">constraints'</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>  </span><span class="hs-comment">-- tell [HardConstraintBroken &quot;TODO: invigilatesExam&quot;]</span><span>
</span><a name="line-280"></a><span>  </span><span class="hs-comment">-- tell [HardConstraintBroken &quot;TODO: impossibleInvigilationSlots&quot;]</span><span>
</span><a name="line-281"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">validationResult</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679060406"><span class="hs-identifier hs-var">notOnSameDayOk</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060407"><span class="hs-identifier hs-var">inSameSlotOk</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060408"><span class="hs-identifier hs-var">onOneOfTheseDaysOk</span></a><span class="hs-special">]</span><span>
</span><a name="line-282"></a><span>
</span><a name="line-283"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-284"></a><span class="hs-comment">-- not on same day</span><span>
</span><a name="line-285"></a><span class="hs-comment">------------------</span><span>
</span><a name="line-286"></a><span class="hs-identifier">validateNotOnSameDay</span><span>
</span><a name="line-287"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-288"></a><a name="validateNotOnSameDay"><a href="Plexams.Validation.ScheduledExams.html#validateNotOnSameDay"><span class="hs-identifier">validateNotOnSameDay</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-289"></a><span class="hs-identifier">validateNotOnSameDay</span><span> </span><a name="local-6989586621679060409"><a href="#local-6989586621679060409"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679060410"><a href="#local-6989586621679060410"><span class="hs-identifier">listOfAncodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-290"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Validate exams not on same day&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-291"></a><span>  </span><span class="hs-identifier hs-var">validationResult</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Plexams.Validation.ScheduledExams.html#validateNotOnSameDay%27"><span class="hs-identifier hs-var">validateNotOnSameDay'</span></a><span> </span><a href="#local-6989586621679060409"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060410"><span class="hs-identifier hs-var">listOfAncodes</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-identifier">validateNotOnSameDay'</span><span>
</span><a name="line-294"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-295"></a><a name="validateNotOnSameDay%27"><a href="Plexams.Validation.ScheduledExams.html#validateNotOnSameDay%27"><span class="hs-identifier">validateNotOnSameDay'</span></a></a><span> </span><a name="local-6989586621679060411"><a href="#local-6989586621679060411"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679060412"><a href="#local-6989586621679060412"><span class="hs-identifier">ancodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-296"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060413"><a href="#local-6989586621679060413"><span class="hs-identifier">ancodesAndDays</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span>
</span><a name="line-297"></a><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679060415"><a href="#local-6989586621679060415"><span class="hs-identifier">ancode</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-298"></a><span>          </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679060415"><span class="hs-identifier hs-var">ancode</span></a><span>
</span><a name="line-299"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060416"><a href="#local-6989586621679060416"><span class="hs-identifier">exams'</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">queryByAnCode</span><span> </span><a href="#local-6989586621679060415"><span class="hs-identifier hs-var">ancode</span></a><span> </span><a href="#local-6989586621679060411"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-300"></a><span>                </span><a name="local-6989586621679060417"><a href="#local-6989586621679060417"><span class="hs-identifier">maybeDay</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679060416"><span class="hs-identifier hs-var">exams'</span></a><span class="hs-special">)</span><span>
</span><a name="line-301"></a><span>            </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060416"><span class="hs-identifier hs-var">exams'</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679060417"><span class="hs-identifier hs-var">maybeDay</span></a><span>
</span><a name="line-302"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-304"></a><span>        </span><a href="#local-6989586621679060412"><span class="hs-identifier hs-var">ancodes</span></a><span>
</span><a name="line-305"></a><span>      </span><a name="local-6989586621679060414"><a href="#local-6989586621679060414"><span class="hs-identifier">ancodesAndDaysOk</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-306"></a><span>        </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679060413"><span class="hs-identifier hs-var">ancodesAndDays</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679060413"><span class="hs-identifier hs-var">ancodesAndDays</span></a><span>
</span><a name="line-307"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679060414"><span class="hs-identifier hs-var">ancodesAndDaysOk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-308"></a><span>    </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">SoftConstraintBroken</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;- not okay for &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060413"><span class="hs-identifier hs-var">ancodesAndDays</span></a><span class="hs-special">]</span><span>
</span><a name="line-309"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060414"><span class="hs-identifier hs-var">ancodesAndDaysOk</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">SoftConstraintsBroken</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-312"></a><span class="hs-comment">-- one of these days</span><span>
</span><a name="line-313"></a><span class="hs-comment">--------------------</span><span>
</span><a name="line-314"></a><span class="hs-identifier">validateOneOfTheseDays</span><span>
</span><a name="line-315"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-316"></a><a name="validateOneOfTheseDays"><a href="Plexams.Validation.ScheduledExams.html#validateOneOfTheseDays"><span class="hs-identifier">validateOneOfTheseDays</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-317"></a><span class="hs-identifier">validateOneOfTheseDays</span><span> </span><a name="local-6989586621679060418"><a href="#local-6989586621679060418"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679060419"><a href="#local-6989586621679060419"><span class="hs-identifier">ancodesAndDays</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-318"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Validate exams on one of these days&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-319"></a><span>  </span><span class="hs-identifier hs-var">validationResult</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Plexams.Validation.ScheduledExams.html#validateOneOfTheseDays%27"><span class="hs-identifier hs-var">validateOneOfTheseDays'</span></a><span> </span><a href="#local-6989586621679060418"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060419"><span class="hs-identifier hs-var">ancodesAndDays</span></a><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-identifier">validateOneOfTheseDays'</span><span>
</span><a name="line-322"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-323"></a><a name="validateOneOfTheseDays%27"><a href="Plexams.Validation.ScheduledExams.html#validateOneOfTheseDays%27"><span class="hs-identifier">validateOneOfTheseDays'</span></a></a><span> </span><a name="local-6989586621679060420"><a href="#local-6989586621679060420"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679060421"><a href="#local-6989586621679060421"><span class="hs-identifier">ancode</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060422"><a href="#local-6989586621679060422"><span class="hs-identifier">days</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-324"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060423"><a href="#local-6989586621679060423"><span class="hs-identifier">exams'</span></a></a><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">queryByAnCode</span><span> </span><a href="#local-6989586621679060421"><span class="hs-identifier hs-var">ancode</span></a><span> </span><a href="#local-6989586621679060420"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-325"></a><span>      </span><a name="local-6989586621679060424"><a href="#local-6989586621679060424"><span class="hs-identifier">oneOfTheseDaysOk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679060423"><span class="hs-identifier hs-var">exams'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-326"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-327"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679060425"><a href="#local-6989586621679060425"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679060425"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">elem</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679060422"><span class="hs-identifier hs-var">days</span></a><span>
</span><a name="line-328"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060423"><span class="hs-identifier hs-var">exams'</span></a><span>
</span><a name="line-329"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;- exam &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060421"><span class="hs-identifier hs-var">ancode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; not found&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-330"></a><span>      </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-331"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-332"></a><span>      </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679060424"><span class="hs-identifier hs-var">oneOfTheseDaysOk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-333"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span>
</span><a name="line-334"></a><span>          </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;- exam &quot;</span><span>
</span><a name="line-335"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060421"><span class="hs-identifier hs-var">ancode</span></a><span>
</span><a name="line-336"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; not on one of &quot;</span><span>
</span><a name="line-337"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060422"><span class="hs-identifier hs-var">days</span></a><span>
</span><a name="line-338"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-339"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060424"><span class="hs-identifier hs-var">oneOfTheseDaysOk</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span>
</span><a name="line-340"></a><span>
</span><a name="line-341"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- fixed slot</span><span>
</span><a name="line-343"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-344"></a><span class="hs-identifier">validateFixSlot</span><span>
</span><a name="line-345"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span>
</span><a name="line-346"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-347"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-348"></a><a name="validateFixSlot"><a href="Plexams.Validation.ScheduledExams.html#validateFixSlot"><span class="hs-identifier">validateFixSlot</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-349"></a><span class="hs-identifier">validateFixSlot</span><span> </span><a name="local-6989586621679060426"><a href="#local-6989586621679060426"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679060427"><a href="#local-6989586621679060427"><span class="hs-identifier">ancodesAndSlots</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-350"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Validate exams in fixed slot&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-351"></a><span>  </span><span class="hs-identifier hs-var">validationResult</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Plexams.Validation.ScheduledExams.html#validateFixSlot%27"><span class="hs-identifier hs-var">validateFixSlot'</span></a><span> </span><a href="#local-6989586621679060426"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060427"><span class="hs-identifier hs-var">ancodesAndSlots</span></a><span>
</span><a name="line-352"></a><span>
</span><a name="line-353"></a><span class="hs-identifier">validateFixSlot'</span><span>
</span><a name="line-354"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-355"></a><a name="validateFixSlot%27"><a href="Plexams.Validation.ScheduledExams.html#validateFixSlot%27"><span class="hs-identifier">validateFixSlot'</span></a></a><span> </span><a name="local-6989586621679060428"><a href="#local-6989586621679060428"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679060429"><a href="#local-6989586621679060429"><span class="hs-identifier">ancode</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679060430"><a href="#local-6989586621679060430"><span class="hs-identifier">d</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060431"><a href="#local-6989586621679060431"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-356"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060432"><a href="#local-6989586621679060432"><span class="hs-identifier">exams'</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">queryByAnCode</span><span> </span><a href="#local-6989586621679060429"><span class="hs-identifier hs-var">ancode</span></a><span> </span><a href="#local-6989586621679060428"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-357"></a><span>      </span><a name="local-6989586621679060433"><a href="#local-6989586621679060433"><span class="hs-identifier">fixedSlotOk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">slot</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679060432"><span class="hs-identifier hs-var">exams'</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-358"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-359"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679060434"><a href="#local-6989586621679060434"><span class="hs-identifier">d'</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060435"><a href="#local-6989586621679060435"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679060434"><span class="hs-identifier hs-var">d'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679060430"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679060435"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679060431"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-360"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060432"><span class="hs-identifier hs-var">exams'</span></a><span>
</span><a name="line-361"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;- exam &quot;</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060429"><span class="hs-identifier hs-var">ancode</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; not found&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-362"></a><span>      </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-363"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-364"></a><span>      </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679060433"><span class="hs-identifier hs-var">fixedSlotOk</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-365"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span>
</span><a name="line-366"></a><span>          </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;- exam &quot;</span><span>
</span><a name="line-367"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060429"><span class="hs-identifier hs-var">ancode</span></a><span>
</span><a name="line-368"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; not in slot &quot;</span><span>
</span><a name="line-369"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679060430"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679060431"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-370"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-371"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060433"><span class="hs-identifier hs-var">fixedSlotOk</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span>
</span><a name="line-372"></a><span>
</span><a name="line-373"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- in sams slot</span><span>
</span><a name="line-375"></a><span class="hs-comment">-------------</span><span>
</span><a name="line-376"></a><span class="hs-identifier">validateInSameSlot</span><span>
</span><a name="line-377"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-378"></a><a name="validateInSameSlot"><a href="Plexams.Validation.ScheduledExams.html#validateInSameSlot"><span class="hs-identifier">validateInSameSlot</span></a></a><span> </span><span class="hs-identifier">_</span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-379"></a><span class="hs-identifier">validateInSameSlot</span><span> </span><a name="local-6989586621679060436"><a href="#local-6989586621679060436"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679060437"><a href="#local-6989586621679060437"><span class="hs-identifier">ancodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-380"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Validate exams that should be in same slot&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-381"></a><span>  </span><span class="hs-identifier hs-var">validationResult</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><span class="hs-special">(</span><a href="Plexams.Validation.ScheduledExams.html#validateInSameSlot%27"><span class="hs-identifier hs-var">validateInSameSlot'</span></a><span> </span><a href="#local-6989586621679060436"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060437"><span class="hs-identifier hs-var">ancodes</span></a><span>
</span><a name="line-382"></a><span>
</span><a name="line-383"></a><span class="hs-identifier">validateInSameSlot'</span><span>
</span><a name="line-384"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Ancode</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-385"></a><a name="validateInSameSlot%27"><a href="Plexams.Validation.ScheduledExams.html#validateInSameSlot%27"><span class="hs-identifier">validateInSameSlot'</span></a></a><span> </span><a name="local-6989586621679060438"><a href="#local-6989586621679060438"><span class="hs-identifier">plan</span></a></a><span> </span><a name="local-6989586621679060439"><a href="#local-6989586621679060439"><span class="hs-identifier">ancodes</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-386"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679060440"><a href="#local-6989586621679060440"><span class="hs-identifier">exams'</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">queryByAnCode</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679060438"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060439"><span class="hs-identifier hs-var">ancodes</span></a><span>
</span><a name="line-387"></a><span>      </span><a name="local-6989586621679060441"><a href="#local-6989586621679060441"><span class="hs-identifier">allInSameSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">slot</span><span> </span><a href="#local-6989586621679060440"><span class="hs-identifier hs-var">exams'</span></a><span>
</span><a name="line-388"></a><span>  </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679060441"><span class="hs-identifier hs-var">allInSameSlot</span></a><span>
</span><a name="line-389"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span>
</span><a name="line-390"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-391"></a><span>      </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-392"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span>
</span><a name="line-393"></a><span>          </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;- exams &quot;</span><span>
</span><a name="line-394"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060439"><span class="hs-identifier hs-var">ancodes</span></a><span>
</span><a name="line-395"></a><span>          </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-string">&quot; not in same slot &quot;</span><span>
</span><a name="line-396"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-397"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span>
</span><a name="line-398"></a><span>
</span><a name="line-399"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-400"></a><span class="hs-comment">-- each lecturer should have zero or one exams per slot</span><span>
</span><a name="line-401"></a><span class="hs-comment">-------------------------------------------------------</span><span>
</span><a name="line-402"></a><span class="hs-identifier">validateLecturerMaxOneExamPerSlot</span><span>
</span><a name="line-403"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-404"></a><a name="validateLecturerMaxOneExamPerSlot"><a href="Plexams.Validation.ScheduledExams.html#validateLecturerMaxOneExamPerSlot"><span class="hs-identifier">validateLecturerMaxOneExamPerSlot</span></a></a><span> </span><a name="local-6989586621679060442"><a href="#local-6989586621679060442"><span class="hs-identifier">plan</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-405"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">Info</span><span> </span><span class="hs-string">&quot;### Validate numbers of exams per lecturer per slot (soft)&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-406"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-407"></a><span>    </span><a name="local-6989586621679060443"><a href="#local-6989586621679060443"><span class="hs-identifier">listsOfLecturers</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-408"></a><span>      </span><span class="hs-identifier hs-var">map</span><span>
</span><a name="line-409"></a><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679060445"><a href="#local-6989586621679060445"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679060446"><a href="#local-6989586621679060446"><span class="hs-identifier">es</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-410"></a><span>            </span><span class="hs-special">(</span><span> </span><a href="#local-6989586621679060445"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-411"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">lecturer</span><span>
</span><a name="line-412"></a><span>              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">filter</span><span>
</span><a name="line-413"></a><span>                  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">notElem</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">inSameSlot</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">constraints</span><span> </span><a href="#local-6989586621679060442"><span class="hs-identifier hs-var">plan</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">anCode</span><span>
</span><a name="line-414"></a><span>                  </span><span class="hs-special">)</span><span>
</span><a name="line-415"></a><span>              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.elems</span><span>
</span><a name="line-416"></a><span>              </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">examsInSlot</span><span> </span><a href="#local-6989586621679060446"><span class="hs-identifier hs-var">es</span></a><span>
</span><a name="line-417"></a><span>            </span><span class="hs-special">)</span><span>
</span><a name="line-418"></a><span>          </span><span class="hs-special">)</span><span>
</span><a name="line-419"></a><span>        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">M.toList</span><span>
</span><a name="line-420"></a><span>        </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">slots</span><span> </span><a href="#local-6989586621679060442"><span class="hs-identifier hs-var">plan</span></a><span>
</span><a name="line-421"></a><span>    </span><a name="local-6989586621679060444"><a href="#local-6989586621679060444"><span class="hs-identifier">slotsWithDuplicates</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">nub</span><span> </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">id</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679060443"><span class="hs-identifier hs-var">listsOfLecturers</span></a><span>
</span><a name="line-422"></a><span>  </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679060444"><span class="hs-identifier hs-var">slotsWithDuplicates</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679060447"><a href="#local-6989586621679060447"><span class="hs-identifier">lecturers</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">tell</span><span>
</span><a name="line-423"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">HardConstraintBroken</span><span>
</span><a name="line-424"></a><span>      </span><span class="hs-operator hs-var">$</span><span>        </span><span class="hs-string">&quot;-   lecturer has more then one exam in slot: &quot;</span><span>
</span><a name="line-425"></a><span>      </span><span class="hs-special">`</span><span class="hs-identifier hs-var">append</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">showt</span><span> </span><a href="#local-6989586621679060447"><span class="hs-identifier hs-var">lecturers</span></a><span>
</span><a name="line-426"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-427"></a><span>  </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-428"></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">null</span><span> </span><a href="#local-6989586621679060444"><span class="hs-identifier hs-var">slotsWithDuplicates</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">EverythingOk</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">HardConstraintsBroken</span><span>
</span><a name="line-429"></a><span>
</span><a name="line-430"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-431"></a><span class="hs-comment">-- each student should have two exams max per day</span><span>
</span><a name="line-432"></a><span class="hs-comment">-------------------------------------------------</span><span>
</span><a name="line-433"></a><span class="hs-comment">-- TODO: Unterscheidung ob zwei Erstpr&#252;fungen an einem Tag oder Wiederholungs-</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- pr&#252;fungen</span><span>
</span><a name="line-435"></a><span class="hs-identifier">validateStudentsMaxTwoExamsPerDay</span><span>
</span><a name="line-436"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Plan</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Writer</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">ValidationRecord</span><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-type">ValidationResult</span><span>
</span><a name="line-437"></a><a name="validateStudentsMaxTwoExamsPerDay"><a href="Plexams.Validation.ScheduledExams.html#validateStudentsMaxTwoExamsPerDay"><span class="hs-identifier">validateStudentsMaxTwoExamsPerDay</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-438"></a><span>  </span><span class="hs-identifier hs-var">tell</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">ValidationRecord</span><span> </span><span class="hs-identifier hs-var">SoftConstraintBroken</span><span> </span><span class="hs-string">&quot;not testing exams for students atm, TODO&quot;</span><span class="hs-special">]</span><span>
</span><a name="line-439"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-identifier hs-var">SoftConstraintsBroken</span><span>
</span><a name="line-440"></a><span class="hs-comment">-- plan</span><span>
</span><a name="line-441"></a><span class="hs-comment">--   -- TODO: hard/soft okay?</span><span>
</span><a name="line-442"></a><span class="hs-comment">--  = do</span><span>
</span><a name="line-443"></a><span class="hs-comment">--   tell</span><span>
</span><a name="line-444"></a><span class="hs-comment">--     [ Info $</span><span>
</span><a name="line-445"></a><span class="hs-comment">--       &quot;### Validate numbers of exams per student per day&quot; `append`</span><span>
</span><a name="line-446"></a><span class="hs-comment">--       &quot; (2 are soft, 3 are hard, but not if noOfExams &gt; 13)&quot;</span><span>
</span><a name="line-447"></a><span class="hs-comment">--     ]</span><span>
</span><a name="line-448"></a><span class="hs-comment">--   let examsPerDays :: [[Ancode]]</span><span>
</span><a name="line-449"></a><span class="hs-comment">--       examsPerDays =</span><span>
</span><a name="line-450"></a><span class="hs-comment">--         map</span><span>
</span><a name="line-451"></a><span class="hs-comment">--           (\d -&gt;</span><span>
</span><a name="line-452"></a><span class="hs-comment">--              concatMap (M.keys . examsInSlot) $</span><span>
</span><a name="line-453"></a><span class="hs-comment">--              mapMaybe</span><span>
</span><a name="line-454"></a><span class="hs-comment">--                (\s -&gt; M.lookup (d, s) (slots plan))</span><span>
</span><a name="line-455"></a><span class="hs-comment">--                [0 .. maxSlotIndex plan])</span><span>
</span><a name="line-456"></a><span class="hs-comment">--           [0 .. maxDayIndex plan]</span><span>
</span><a name="line-457"></a><span class="hs-comment">--       studentsWithMoreThanOneExamPerDay =</span><span>
</span><a name="line-458"></a><span class="hs-comment">--         map mkTuples $ groupWith head $ concatMap checkStudents examsPerDays</span><span>
</span><a name="line-459"></a><span class="hs-comment">--       checkStudents :: [Ancode] -&gt; [[MtkNr]]</span><span>
</span><a name="line-460"></a><span class="hs-comment">--       checkStudents =</span><span>
</span><a name="line-461"></a><span class="hs-comment">--         filter ((&gt; 1) . length) .</span><span>
</span><a name="line-462"></a><span class="hs-comment">--         groupWith id .</span><span>
</span><a name="line-463"></a><span class="hs-comment">--         concatMap (map fst . S.toList) .</span><span>
</span><a name="line-464"></a><span class="hs-comment">--         mapMaybe (\a -&gt; M.lookup a (students plan))</span><span>
</span><a name="line-465"></a><span class="hs-comment">--       mkTuples :: [[MtkNr]] -&gt; (MtkNr, [Int])</span><span>
</span><a name="line-466"></a><span class="hs-comment">--       mkTuples mtknr' = (head $ head mtknr', map length mtknr')</span><span>
</span><a name="line-467"></a><span class="hs-comment">--       -- oneHasThree = filter (\(_, examsPerDay) -&gt; any (&gt;2) examsPerDay)</span><span>
</span><a name="line-468"></a><span class="hs-comment">--       --                       studentsWithMoreThanOneExamPerDay</span><span>
</span><a name="line-469"></a><span class="hs-comment">--       allAncodes = map anCode $ allExams plan</span><span>
</span><a name="line-470"></a><span class="hs-comment">--   forM_ studentsWithMoreThanOneExamPerDay $ \(mtknr', noOfExams) -&gt; do</span><span>
</span><a name="line-471"></a><span class="hs-comment">--     let exams' =</span><span>
</span><a name="line-472"></a><span class="hs-comment">--           maybe [] (filter (`elem` allAncodes) . S.toList . snd) $</span><span>
</span><a name="line-473"></a><span class="hs-comment">--           M.lookup mtknr' $ studentsExams plan</span><span>
</span><a name="line-474"></a><span class="hs-comment">--     let three = any (&gt; 2) noOfExams</span><span>
</span><a name="line-475"></a><span class="hs-comment">--     tell</span><span>
</span><a name="line-476"></a><span class="hs-comment">--       [ SoftConstraintBroken $</span><span>
</span><a name="line-477"></a><span class="hs-comment">--         (if three</span><span>
</span><a name="line-478"></a><span class="hs-comment">--            then &quot;-   Student has three or more exams a day:&quot;</span><span>
</span><a name="line-479"></a><span class="hs-comment">--            else &quot;-   Student has two exams per day: &quot;) `append`</span><span>
</span><a name="line-480"></a><span class="hs-comment">--         showt noOfExams `append`</span><span>
</span><a name="line-481"></a><span class="hs-comment">--         &quot; of &quot; `append`</span><span>
</span><a name="line-482"></a><span class="hs-comment">--         showt (length exams') `append`</span><span>
</span><a name="line-483"></a><span class="hs-comment">--         &quot;, MtkNr &quot; `append`</span><span>
</span><a name="line-484"></a><span class="hs-comment">--         showt mtknr' `append`</span><span>
</span><a name="line-485"></a><span class="hs-comment">--         &quot;  \n&quot; `append`</span><span>
</span><a name="line-486"></a><span class="hs-comment">--         showt exams'</span><span>
</span><a name="line-487"></a><span class="hs-comment">--       ]</span><span>
</span><a name="line-488"></a><span class="hs-comment">--   return $</span><span>
</span><a name="line-489"></a><span class="hs-comment">--     if null studentsWithMoreThanOneExamPerDay</span><span>
</span><a name="line-490"></a><span class="hs-comment">--       then EverythingOk</span><span>
</span><a name="line-491"></a><span class="hs-comment">--       else SoftConstraintsBroken {- if null oneHasThree</span><span>
</span><a name="line-492"></a><span class="hs-comment">--                 then SoftConstraintsBroken</span><span>
</span><a name="line-493"></a><span class="hs-comment">--                 else let nosOfExams = map length</span><span>
</span><a name="line-494"></a><span class="hs-comment">--                            $ mapMaybe ((`M.lookup` studentsExams plan) . fst)</span><span>
</span><a name="line-495"></a><span class="hs-comment">--                                       oneHasThree</span><span>
</span><a name="line-496"></a><span class="hs-comment">--                      in if all (&gt;13) nosOfExams</span><span>
</span><a name="line-497"></a><span class="hs-comment">--                         then SoftConstraintsBroken</span><span>
</span><a name="line-498"></a><span class="hs-comment">--                         else HardConstraintsBroken -}</span><span>
</span><a name="line-499"></a></pre></body></html>